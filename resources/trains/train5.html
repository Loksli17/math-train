<style type="text/css">
    .section {
        width: 600px;
        padding: 40px;
    }

    #canvas {
        border: 1px dashed;
    }


    .button {
        padding: 10px 15px;
        background: #ccc;
        border-radius: 5px;
        width: max-content;
        margin-top: 15px;
    }

    .button:hover {
        transition: 0.5s;
        cursor: pointer;
        background: #fcc;
    }

    .cont-button {
        margin-top: 20px;
    }
</style>







<div class="section" id='section'>


    <canvas id="canvas">
    </canvas>

    <label class="label">
        <span><b>Рёбра графа</b></span>
        <div id="list"></div>
    </label>

    <form action="" method="post">
        <label class="label">
            <span>Эксцентриситет</span>
            <input type="text" name="eccent" value=""><br>
            <span>Радиус</span>
            <input type="text" name="rad" value=""><br>
            <span>Диаметр</span>
            <input type="text" name="diam" value="">
            <div></div>
        </label>

        <label class="label">
            <span><b>Размер матрицы смежности: </b></span>
            <select name="width" id="width">

            </select>
            <span>x</span>
            <select name="height" id="height">

            </select>
            <div></div>

        </label>

        <label class="label">
            <table id="adjac">

            </table>
            <div></div>
        </label>

    </form>

    <div class="cont-button">
        <div id='give-desicion' class="button">
            Решить
        </div>
        <div class="result">
        </div>
    </div>
</div>



<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="models/graphVertex.js"></script>
<script type="text/javascript" src="models/graph.js"></script>


<script>
    $(document).ready(function() {
        var canvas = document.getElementById("canvas");
        let graph = new Graph(7, 9, 200, 15, 0, 0, 0);

        //функция изменения размера канваса
        function changeWidthCanvas() {
            context = canvas.getContext("2d");
            var sectionSize = document.getElementById("section").getBoundingClientRect();
            canvas.setAttribute('width', sectionSize.width);
            canvas.setAttribute('height', 600);
        }

        function printList(array) {
            let list = document.createElement("ul");
            for (let el of array) {
                let item = document.createElement("li");
                item.appendChild(document.createTextNode(String.fromCharCode(el.start.name) + String.fromCharCode(el.end.name) + ": " + el.dist));
                list.appendChild(item);
            }
            return list;
        }

        function populateDropMenu(graph) {
            let w = document.getElementById("width");
            let h = document.getElementById("height");

            for (let i = 0; i < graph.countVertex; i++) {
                w[i] = new Option(i + 1);
                h[i] = new Option(i + 1);
            }
        }

        //document.getElementById("resizeBtn").addEventListener("click", );

        //вот эту муйню бы оптимизировать
        document.getElementById("width").addEventListener("change", () => {
            let table = document.getElementById("adjac");
            table.deleteTHead();
            let thead = table.createTHead();
            let col = thead.insertRow();
            let w = document.getElementById("width").value;
            let h = document.getElementById("height").value;
            for (let i = 0; i < h; i++) {
                let row = table.insertRow();
                for (let j = 0; j < w; j++) {
                    let cell = row.insertCell();
                    let input = document.createElement("input");
                    input.type = "text";
                    input.id = "row" + i + "col" + j;
                    cell.appendChild(input);
                }
            }
        });
        document.getElementById("height").addEventListener("change", () => {
            let table = document.getElementById("adjac");
            table.deleteTHead();
            let thead = table.createTHead();
            let col = thead.insertRow();
            let w = document.getElementById("width").value;
            let h = document.getElementById("height").value;
            for (let i = 0; i < h; i++) {
                let row = table.insertRow();
                for (let j = 0; j < w; j++) {
                    let cell = row.insertCell();
                    let input = document.createElement("input");
                    input.type = "text";
                    input.id = "row" + i + "col" + j;
                    cell.appendChild(input);
                }
            }
        });

        function checkMatrix(table) {
            let adjac = new Array();
            for (let i = 0; i < table.rows.length - 1; i++) {
                adjac[i] = new Array();
            }
            for (let i = 0; i < table.rows.length; i++) {
                for (let j = 0; j < table.rows[i].cells.length; j++) {
                    adjac[i - 1][j] = document.getElementById(`row${i - 1}col${j}`).value;
                }
            }
            return adjac;
        }

        //отрисовка канваса после загрузки страницы
        changeWidthCanvas();

        //отловим изменение окна
        $(window).resize(function() {
            changeWidthCanvas();
            graph.createVertex(canvas);
            graph.draw(canvas);
        });

        graph.createVertex(canvas);
        graph.getDist();
        graph.getIncid();
        graph.removeDoubles();
        //graph.calcEccent();
        graph.draw(canvas);
        populateDropMenu(graph);

        //generateTable();
        document.getElementById("list").appendChild(printList(graph.vector));

        canvas.addEventListener('mousedown', function(e) {
            x = e.offsetX;
            y = e.offsetY;
            graph.checkClick(x, y, canvas);
        });

        $('#give-desicion').on('click', function() {
            //проверка решения после нажатия на кнопку

            //пример обхода графа
            // for (let i = 0; i < graph.countVertex; i++) {
            //     for (let j = 0; j < graph.countVertex; j++) {
            //         if (!graph.adjac[i][j]) {
            //             $('.result').text('Неверно').css({
            //                 'color': 'red'
            //             });
            //             $('#give-desicion').hide();
            //             return 0;
            //         }
            //     }
            // }
            //тестовая проверка матрицы (удивительно, но работает)
            let matAdj = checkMatrix(document.getElementById("adjac"));
            for (let i = 0; i < matAdj.length; i++) {
                for (let j = 0; j < matAdj[i].length; j++) {
                    if (matAdj[i][j] != graph.adjac[i][j]) {
                        $('.result').text('Неверно').css({
                            'color': 'red'
                        });
                        $('#give-desicion').hide();
                        return 0;
                    }
                }
            }

            $('.result').text('Верно').css({
                'color': 'green'
            });
            $('#give-desicion').hide();
        });



    });
</script>